<#
.SYNOPSIS
    Remediates STIG ID WN11-AU-000500 by enforcing the Application Event Log maximum size to 32768 KB (32 MB)
    using the Administrative Templates policy registry key. Also sets the runtime key for consistency.

.NOTES
    Author          : Jordan Calvert
    LinkedIn        : linkedin.com/in/jordanryancalvert/
    GitHub          : github.com/awl4114awl
    Date Created    : 2025-12-12
    Last Modified   : 2025-12-12
    Version         : 1.0
    CVEs            : N/A
    Plugin IDs      : N/A
    STIG-ID         : WN11-AU-000500

.TESTED ON
    Systems Tested  : Windows 11 Pro (25H2)

.USAGE
    Run PowerShell as Administrator:
    PS C:\> Set-ExecutionPolicy -Scope Process Bypass
    PS C:\> .\remediation-WN11-AU-000500.ps1

    Note:
    In some lab environments, gpupdate can remove policy values if the Local GPO setting is Disabled/Not Configured.
    This script intentionally does NOT run gpupdate to avoid the policy engine deleting the value before a rescan.
#>

# WN11-AU-000500 - Remediate Application Event Log Max Size (Policy + Runtime)
$TargetKB = 32768

$PolicyKey = "HKLM\SOFTWARE\Policies\Microsoft\Windows\EventLog\Application"
$RuntimeKey = "HKLM\SYSTEM\CurrentControlSet\Services\EventLog\Application"

# Ensure policy key exists
& "$env:windir\System32\reg.exe" ADD "$PolicyKey" /f | Out-Null

# Set policy value (what Tenable STIG audits usually check)
& "$env:windir\System32\reg.exe" ADD "$PolicyKey" /v MaxSize /t REG_DWORD /d $TargetKB /f | Out-Null

# Set runtime value too (optional but recommended)
& "$env:windir\System32\reg.exe" ADD "$RuntimeKey" /v MaxSize /t REG_DWORD /d $TargetKB /f | Out-Null

# Verify immediately
"Policy verification:"
& "$env:windir\System32\reg.exe" QUERY "$PolicyKey" /v MaxSize

"Runtime verification:"
& "$env:windir\System32\reg.exe" QUERY "$RuntimeKey" /v MaxSize
