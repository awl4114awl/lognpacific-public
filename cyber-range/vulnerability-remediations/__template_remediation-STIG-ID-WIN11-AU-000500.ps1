<#
.SYNOPSIS
    FORCED remediation for STIG ID WN11-AU-000500.
    Sets the Windows Application event log maximum size to exactly 32768 KB (32 MB),
    regardless of current value.

.NOTES
    Author          : Jordan Calvert
    LinkedIn        : linkedin.com/in/jordanryancalvert/
    GitHub          : github.com/awl4114awl
    Date Created    : 2025-12-12
    Last Modified   : 2025-12-12
    Version         : 1.3
    STIG-ID         : WN11-AU-000500

.USAGE
    Run PowerShell as Administrator:
    PS C:\> .\force-remediation-WN11-AU-000500.ps1
#>

$ErrorActionPreference = "Stop"
$TargetKB = 32768

# Local (classic) setting
$localPath  = "HKLM:\SYSTEM\CurrentControlSet\Services\EventLog\Application"
$localValue = "MaxSize"

# Group Policy (Administrative Templates) setting (what STIG audits usually check)
$policyPath  = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Application"
$policyValue = "MaxSize"

Write-Host "WIN11-AU-000500 FORCE"
Write-Host "Setting Application log MaxSize to $TargetKB KB (policy + local)..."
Write-Host ""

# Ensure keys exist
New-Item -Path $localPath  -Force | Out-Null
New-Item -Path $policyPath -Force | Out-Null

# Force set BOTH
Set-ItemProperty -Path $localPath  -Name $localValue  -Type DWord -Value $TargetKB
Set-ItemProperty -Path $policyPath -Name $policyValue -Type DWord -Value $TargetKB

# Refresh policy
gpupdate /force | Out-Null

# Verify BOTH
$local  = (Get-ItemProperty -Path $localPath  -Name $localValue  -ErrorAction Stop).$localValue
$policy = (Get-ItemProperty -Path $policyPath -Name $policyValue -ErrorAction Stop).$policyValue

Write-Host "Verified LOCAL  MaxSize: $local KB  ($localPath)"
Write-Host "Verified POLICY MaxSize: $policy KB ($policyPath)"

if ($local -ge $TargetKB -and $policy -ge $TargetKB) {
    Write-Host "`nSuccess: WIN11-AU-000500 enforced (policy + local)."
    exit 0
} else {
    throw "Verification failed."
}
