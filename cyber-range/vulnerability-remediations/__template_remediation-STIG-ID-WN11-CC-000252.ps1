<#
.SYNOPSIS
    Remediates STIG ID WN11-CC-000252 by disabling Windows Game Recording
    and Broadcasting through policy-backed registry enforcement.

.DESCRIPTION
    WN11-CC-000252 requires Windows Game Recording and Broadcasting
    (GameDVR) to be disabled.

    Compliance is evaluated based on the presence and value of a
    policy-backed registry setting rather than Local Group Policy
    Editor state.

    This script:
      - Ensures the policy registry path exists
      - Sets AllowGameDVR to a STIG-compliant value
      - Verifies the applied configuration

.NOTES
    Requires elevated PowerShell session.
#>

# Define registry path and value
$RegPath = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\GameDVR"
$ValueName = "AllowGameDVR"
$ValueData = 0  # 0 = Disabled (STIG-compliant)

# Ensure registry path exists
if (-not (Test-Path $RegPath)) {
    New-Item -Path $RegPath -Force | Out-Null
}

# Apply STIG-compliant setting
New-ItemProperty `
    -Path $RegPath `
    -Name $ValueName `
    -PropertyType DWORD `
    -Value $ValueData `
    -Force | Out-Null

# Verify configuration
$CurrentValue = Get-ItemProperty -Path $RegPath -Name $ValueName -ErrorAction SilentlyContinue

Write-Host "WN11-CC-000252 remediation applied."
Write-Host "Registry Path : $RegPath"
Write-Host "Value Name    : $ValueName"
Write-Host "Value Data    : $($CurrentValue.$ValueName)"

# Refresh policy
gpupdate /force | Out-Null

Write-Host "Policy refresh complete. Reboot recommended for full enforcement."
