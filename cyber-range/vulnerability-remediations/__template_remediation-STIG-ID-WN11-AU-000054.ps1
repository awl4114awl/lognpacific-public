<#
.SYNOPSIS
    Remediates STIG ID WN11-AU-000054 by enabling failure auditing for
    Logon/Logoff >> Account Lockout using Advanced Audit Policy.

.DESCRIPTION
    WN11-AU-000054 requires the system to audit account lockout failures.
    This control is enforced through Advanced Audit Policy configuration,
    not traditional registry-based Group Policy settings.

    This script enables failure auditing for the "Account Lockout"
    subcategory using the auditpol utility and verifies the effective
    audit policy state after remediation.

.NOTES
    Author          : Jordan Calvert
    GitHub          : https://github.com/awl4114awl
    Date Created    : 2025-12-29
    Last Modified   : 2025-12-29
    Version         : 1.0
    STIG-ID         : WN11-AU-000054
    Severity        : Medium (CAT II)

.TESTED ON
    Windows 11 Pro (25H2)

.USAGE
    Run PowerShell as Administrator:

    PS C:\> Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
    PS C:\> .\__template_remediation-STIG-ID-WN11-AU-000054.ps1
#>

Write-Host "Applying STIG remediation for WN11-AU-000054..." -ForegroundColor Cyan

# Enable failure auditing for Account Lockout
$auditSetCmd = 'auditpol /set /subcategory:"Account Lockout" /failure:enable'
Invoke-Expression $auditSetCmd

if ($LASTEXITCODE -ne 0) {
    Write-Host "[!] Failed to configure audit policy for Account Lockout." -ForegroundColor Red
    exit 1
}

# Verify effective audit policy configuration
Write-Host "Verifying audit policy configuration..." -ForegroundColor Cyan
$auditResult = auditpol /get /subcategory:"Account Lockout"

Write-Host $auditResult

if ($auditResult -notmatch "Failure\s*:\s*Enabled") {
    Write-Host "[!] Verification failed: Failure auditing is not enabled." -ForegroundColor Red
    exit 1
}

Write-Host "[+] STIG WN11-AU-000054 successfully remediated." -ForegroundColor Green