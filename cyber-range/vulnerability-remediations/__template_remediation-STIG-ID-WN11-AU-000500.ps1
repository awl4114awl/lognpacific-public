<#
.SYNOPSIS
    This PowerShell script ensures that the maximum size of the Windows
    Application event log is at least 32768 KB (32 MB), as required by
    DISA STIG ID WN10-AU-000500.

.NOTES
    Author          : Jordan Calvert
    LinkedIn        : linkedin.com/in/jordanryancalvert/
    GitHub          : github.com/awl4114awl
    Date Created    : 2025-12-11
    Last Modified   : 2025-12-11
    Version         : 1.1
    CVEs            : N/A
    Plugin IDs      : N/A
    STIG-ID         : WN10-AU-000500

.TESTED ON
    Date(s) Tested  : 
    Tested By       : 
    Systems Tested  : 
    PowerShell Ver. : 

.USAGE
    From an elevated PowerShell session:

        PS C:\> .\__remediation_template(WN10-AU-000500).ps1
        # or override desired size:
        PS C:\> .\__remediation_template(WN10-AU-000500).ps1 -DesiredSizeKB 65536
#>

param(
    # Desired minimum Application log size in KB (STIG requires >= 32768 KB)
    [int]$DesiredSizeKB = 32768
)

# Registry path and value for the Application Event Log STIG
$RegPath   = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\EventLog\Application"
$ValueName = "MaxSize"

Write-Host "[*] Target minimum Application log size: $DesiredSizeKB KB" -ForegroundColor Cyan

# Ensure the registry key exists
if (-not (Test-Path -Path $RegPath)) {
    Write-Host "[*] Registry path not found. Creating: $RegPath" -ForegroundColor Yellow
    New-Item -Path $RegPath -Force | Out-Null
}

# Read current value (if any)
try {
    $current = (Get-ItemProperty -Path $RegPath -Name $ValueName -ErrorAction Stop).$ValueName
    Write-Host "[*] Current MaxSize value: $current KB" -ForegroundColor Cyan
}
catch {
    Write-Host "[*] MaxSize not currently set. It will be created." -ForegroundColor Yellow
    $current = $null
}

# If value is missing or too small, set/raise it
if (-not $current -or $current -lt $DesiredSizeKB) {
    Write-Host "[*] Setting MaxSize to $DesiredSizeKB KB..." -ForegroundColor Green
    New-ItemProperty -Path $RegPath -Name $ValueName -Value $DesiredSizeKB -PropertyType DWord -Force | Out-Null
}
else {
    Write-Host "[*] Existing MaxSize ($current KB) already meets or exceeds requirement. No change needed." -ForegroundColor Green
}

# (Optional) Trigger Group Policy refresh for the computer
try {
    Write-Host "[*] Running 'gpupdate /target:computer /force' to apply policy..." -ForegroundColor Cyan
    gpupdate /target:computer /force | Out-Null
}
catch {
    Write-Warning "gpupdate failed or is unavailable. Run 'gpupdate /force' manually if needed."
}

# Verify final value
$final = (Get-ItemProperty -Path $RegPath -Name $ValueName).$ValueName
Write-Host "[*] Final MaxSize value: $final KB" -ForegroundColor Cyan

if ($final -ge $DesiredSizeKB) {
    Write-Host "[âœ“] STIG WN10-AU-000500 requirement satisfied." -ForegroundColor Green
}
else {
    Write-Warning "[X] STIG WN10-AU-000500 NOT satisfied. Investigate and rerun script."
}