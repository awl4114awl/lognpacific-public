# üõ°Ô∏è Step By Step STIG Automation for STIG ID: WN11-AC-000015

## ‚ÑπÔ∏è Overview

This lab was carried out in The Cyber Range, an Azure-hosted enterprise environment where I replicate real-world detection, investigation, and remediation workflows. In this scenario, I focused on STIG automation using PowerShell combined with Tenable authenticated scanning.

To create a realistic compliance and remediation exercise, I deliberately disabled the Windows Firewall on a Windows 11 Pro virtual machine. I then worked through a structured STIG implementation lifecycle that mirrors how compliance controls are identified, validated, and enforced in an enterprise environment.

The workflow included:
- Scanning the VM with a Windows 11 STIG Audit Policy
- Reviewing scan results and selecting a failed STIG (WN11-AC-000015)
- Implementing the STIG manually and validating success
- Reverting the fix to confirm failure
- Automating the remediation using PowerShell
- Re-scanning to confirm successful enforcement

Through this lab, I demonstrate my ability to interpret STIG requirements, manually validate security controls, translate policy guidance into registry-level configuration changes, and automate compliance enforcement using PowerShell.

---

## üìì Lab Workflow

### 1Ô∏è‚É£ Provision the Windows 11 Virtual Machine

I provisioned a Windows 11 Pro virtual machine in Microsoft Azure using the Cyber Range infrastructure.

| Component | Details |
|---------|--------|
| VM Name | win11-STIG-vm |
| OS Image | Windows 11 25H2 Pro |
| Region | East US 2 |
| VM Size | Standard DS1 v2 (1 vCPU, 3.5 GiB RAM) |
| Security Type | Trusted Launch (Secure Boot + vTPM Enabled) |
| Network | Cyber-Range-VNet / Cyber-Range-Subnet |
| Public IP | 172.177.222.234 |
| Private IP | 10.0.0.160 |
| Disk Encryption | Disabled |
| Auto-Shutdown | Not Enabled |
| Extensions | AzurePolicyforWindows |

---

### 2Ô∏è‚É£ Disable the Windows Firewall

To simulate a misconfigured system commonly encountered in real environments, I disabled the Windows Firewall on the virtual machine.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 092521.png" width="750">
</p>

---

### 3Ô∏è‚É£ Create an Advanced Network Scan and Run a Baseline Scan

I logged into Tenable Vulnerability Management and created a new scan using a User Defined template scan.

- Scanner: LOCAL-SCAN-ENGINE-01
- Target: VM private IP address (10.0.0.160)

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 092641.png" width="750">
</p>

I configured the scan with Windows credentials for authenticated access and added Compliance Checks for DISA Windows 11 STIG v2r4.

To ensure the scan focused only on STIG compliance and completed quickly:

- All vulnerability plugins were disabled
- Only Policy Compliance ‚Üí Windows Compliance Checks were enabled

I then ran the initial baseline scan.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 093335.png" width="750">
</p>

<a href="https://drive.google.com/file/d/1caEDO7j24YndUnr_IYjsQaEEP9YQ_Ydh/view?usp=drive_link">
  <img src="https://img.shields.io/badge/wn11_stig_vm_scan_1_results-0061FF?style=for-the-badge&logo=adobeacrobatreader&logoColor=white">
</a>
<br>

---

### 4Ô∏è‚É£ Investigate Scan Results and Identify the STIG

After reviewing the scan results, I identified a failed STIG: WN11-AC-000015.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 102320.png" width="750">
</p>

According to stigaview.com, The account lockout feature, when enabled, prevents brute-force password attacks on the system. This parameter specifies the period of time that must pass after failed logon attempts before the counter is reset to 0. The smaller this value is, the less effective the account lockout feature will be in protecting the local system.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 094143.png" width="750">
</p>

---

### 5Ô∏è‚É£ Manually Apply the STIG and Verify the Fix

To manually apply STIG WN11-CC-000052, Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Account Policies >> Account Lockout Policy >> "Reset account lockout counter after" to "15" minutes.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 102812.png" width="750">
  <img src="screenshots/Screenshot 2025-12-26 102841.png" width="750">
  <img src="screenshots/Screenshot 2025-12-26 102927.png" width="750">
</p>

After applying the change, I restarted the VM and ran the scan again to validate the fix.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 112958.png" width="750">
  <img src="screenshots/Screenshot 2025-12-26 113114.png" width="750">
</p>


<a href="https://drive.google.com/file/d/1BzZIkR1SEA84_SKoHk93tN8aRqDnOO-A/view?usp=drive_link">
  <img src="https://img.shields.io/badge/wn11_stig_vm_scan_2_results-0061FF?style=for-the-badge&logo=adobeacrobatreader&logoColor=white">
</a>
<br>

---

## 6Ô∏è‚É£ Revert the Fix and Confirm Failure

To confirm that the STIG compliance result for WN11-AC-000015 was directly tied to the account lockout policy configuration, I reverted the system back to a non-compliant state by modifying the local security policy and validating the resulting failure.

I began by exporting the active local security policy to a configuration file using `secedit`:

```powershell
secedit /export /cfg C:\Temp\secpol.cfg
````

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 114638.png" width="750">
</p>

Within the exported configuration file, I navigated to the [System Access] section and initially set the account lockout duration to 0 minutes to force immediate account unlock. This change alone resulted in a policy import error due to an invalid policy dependency.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 114836.png" width="750">
</p>

Upon reviewing the configuration, I identified that Windows enforces a dependency between account lockout settings requiring the lockout duration to be greater than or equal to the reset lockout counter unless both values are explicitly set to zero.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 121720.png" width="750">
</p>

To create a valid but non-compliant configuration, I updated both values as follows:

```text
LockoutDuration = 0
ResetLockoutCount = 0
```

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 120440.png" width="750">
</p>

This combination disables the lockout duration and reset window while remaining acceptable to the local security policy engine.

After correcting the policy dependency, I successfully re-applied the configuration:

```powershell
secedit /configure /db C:\Temp\secedit.sdb /cfg C:\Temp\secpol.cfg /areas SECURITYPOLICY /overwrite
```

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 120623.png" width="750">
</p>

To confirm the effective configuration, I verified the account lockout settings locally:

```powershell
net accounts | findstr /i "Lockout"
```

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 120715.png" width="750">
</p>

I then re-ran the authenticated STIG compliance scan. As expected, STIG WN11-AC-000015 returned to a failed state, confirming that the control is enforced through account lockout policy relationships and that improper lockout enforcement results in non-compliance.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 133440.png" width="750">
  <img src="screenshots/Screenshot 2025-12-26 133459.png" width="750">
</p>

<a href="https://drive.google.com/file/d/1zOBWe5_RUW8CK0p-IFq10VL28KUKP5ue/view?usp=drive_link">
  <img src="https://img.shields.io/badge/wn11_stig_vm_scan_3_results-0061FF?style=for-the-badge&logo=adobeacrobatreader&logoColor=white">
</a>
<br>

---

### 7Ô∏è‚É£ Generate and Apply the PowerShell Remediation

After validating the manual fix and confirming the revert behavior, I translated the STIG requirements for WN11-AC-000015 into an automated PowerShell remediation script.

This control is enforced through local account lockout policy settings, which are interpreted by the Windows Local Security Authority rather than through traditional registry-based Group Policy values. As a result, the remediation script was designed to configure the effective account lockout policy programmatically rather than relying on the Local Security Policy editor.

The script was designed to:

- Enforce a STIG-compliant account lockout duration  
- Ensure the account lockout duration is greater than or equal to the reset lockout counter  
- Preserve valid policy dependencies to avoid invalid configuration states  
- Apply the configuration using supported system utilities rather than manual policy editing
- Verify the effective account lockout settings after remediation
- Support repeatable remediation and validation during STIG compliance testing  

---

### To test the automation:

- I logged back into the virtual machine  
- Downloaded the PowerShell remediation script from my GitHub repository  
- Ran the script in an elevated PowerShell session


Before remediation:
<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 134125.png" width="750">
</p>

After remediation:
<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 135309.png" width="750">
</p>

---

### 8Ô∏è‚É£ Confirm STIG Compliance via Re-Scan

After applying the PowerShell script, I ran another authenticated compliance scan in Tenable.

<p align="left">
  <img src="screenshots/Screenshot 2025-12-26 152251.png" width="750">
  <img src="screenshots/Screenshot 2025-12-26 152319.png" width="750">
</p>

The scan confirmed that STIG WN11-AC-000052 was successfully applied and passed, demonstrating that the automated remediation was effective.

<a href="https://drive.google.com/file/d/1mZ4fZM0sPzwHRtMYd3mmnknQBohCC1z_/view?usp=drive_link">
  <img src="https://img.shields.io/badge/wn11_stig_vm_scan_4_results-0061FF?style=for-the-badge&logo=adobeacrobatreader&logoColor=white">
</a>

<br>

---

### 9Ô∏è‚É£ Conclusion

This lab demonstrates a complete STIG suggesting, validation, and automation lifecycle. By manually implementing, reverting, and then automating the STIG control, I validated both my understanding of DISA STIG requirements and my ability to enforce them programmatically.

This workflow reflects real-world compliance operations where security controls must be validated manually, automated reliably, and continuously verified through authenticated scanning.