# üõ°Ô∏è STIG Automation with PowerShell (Windows 11) ‚Äî **WIN11-AU-00500**

![Cyber Range](https://img.shields.io/badge/Cyber_Range-Lab_Environment-purple?style=for-the-badge)
![Azure](https://img.shields.io/badge/Azure-0078D4?style=for-the-badge&logo=microsoftazure&logoColor=white)
![Tenable](https://img.shields.io/badge/Tenable-00A0E0?style=for-the-badge&logo=tenable&logoColor=white)
![PowerShell](https://img.shields.io/badge/PowerShell-5391FE?style=for-the-badge&logo=powershell&logoColor=white)
![Windows 11](https://img.shields.io/badge/Windows_11-0078D6?style=for-the-badge&logo=windows11&logoColor=white)

---

## ‚ÑπÔ∏è Overview

This lab was carried out in **The Cyber Range**, an Azure-hosted enterprise environment where I replicate real-world detection, investigation, and remediation workflows. In this scenario, I focused on **STIG automation** using **PowerShell** combined with **Tenable authenticated scanning**.

To create a realistic exercise, I deliberately disabled **Windows Firewall** on a Windows 11 Pro VM and followed a structured STIG implementation cycle:

1. I scanned the VM with a **Windows STIG Audit/Compliance policy**
2. I reviewed the results and selected a failed STIG (**WIN11-AU-00500**)
3. I implemented the STIG **manually** and re-scanned to confirm success
4. I reverted the manual fix and re-scanned to confirm failure returns
5. I implemented the same fix **programmatically with PowerShell**
6. I re-scanned to confirm the STIG passed after automation

From this lab, I aim to demonstrate my ability to interpret STIG compliance findings, apply hardening changes manually, convert those requirements into repeatable PowerShell automation, and validate results through authenticated scanning.

---

## üìì Lab Workflow

### 1Ô∏è‚É£ Provision the Windows 11 Virtual Machine

I provisioned a Windows 11 Pro VM in Azure for STIG testing.

| Component | Details |
|---|---|
| **VM Name** | `Windows-11-STIG-vm` |
| **OS Image** | Windows 11 25H2 Pro |
| **Region** | East US 2 |
| **VM Size** | Standard DS1 v2 (1 vCPU, 3.5 GiB RAM) |
| **Security Type** | Trusted Launch (Secure Boot + vTPM Enabled) |
| **Network** | Cyber-Range-VNet / Cyber-Range-Subnet |
| **Public IP** | 172.176.197.84 |
| **Private IP** | 10.0.0.170 |
| **Disk Encryption** | Disabled |
| **Auto-Shutdown** | Not Enabled |
| **Extensions** | AzurePolicyforWindows |

---

### 2Ô∏è‚É£ Disable the Windows Firewall

I disabled Windows Firewall on the VM to support my scanning/testing workflow.

<p align="left">
  <img src="images/image1.png" width="750">
</p>

---

### 3Ô∏è‚É£ Create a Tenable Scan + Run a Baseline Compliance Scan

In Tenable Vulnerability Management, I created a new **Advanced Network Scan** and ran a baseline scan.

* **Scanner:** `LOCAL-SCAN-ENGINE-01`
* **Target:** VM **Private IP** (`10.0.0.170`)

<p align="left">
  <img src="images/image2.png" width="750">
</p>

<p align="left">
  <img src="images/image3.png" width="750">
</p>

**Configuration steps I used:**
* I provided **Windows credentials** (local admin)
* I added **Compliance Checks** for the applicable DISA STIG policy
* For a faster compliance-only scan:
  * I disabled all plugins
  * I enabled only **Policy Compliance ‚Üí Windows Compliance Checks**
* I ran the initial baseline scan and reviewed results

<p align="left">
  <img src="images/image4.png" width="750">
</p>

---

### 4Ô∏è‚É£ Investigate Failed STIG + Identify Manual Fix

From the scan results, I identified the failed control: **WIN11-AU-00500**.

<p align="left">
  <img src="images/image5.png" width="750">
</p>

The STIG intent is to ensure the **Application event log** has sufficient maximum size so audit records aren‚Äôt lost due to log rollover.

<p align="left">
  <img src="images/image6.png" width="750">
</p>

---

### 5Ô∏è‚É£ Apply the STIG Manually + Verify Pass

To manually apply **WIN11-AU-00500**, I configured the **Application Event Log** maximum size to **32,768 KB (32 MB) or greater**.

**Option A ‚Äî Group Policy (preferred in enterprise environments):**
`Computer Configuration ‚Üí Administrative Templates ‚Üí Windows Components ‚Üí Event Log Service ‚Üí Application ‚Üí Specify the maximum log file size (KB)`
* I enabled the setting
* I set the value to **32768** (or higher)

<p align="left">
  <img src="images/image7.png" width="750">
</p>

**Option B ‚Äî Registry (equivalent policy-backed setting):**
`HKLM\SOFTWARE\Policies\Microsoft\Windows\EventLog\Application\MaxSize` (REG_DWORD)
* I set `MaxSize` to **32768** (or higher)

<p align="left">
  <img src="images/image8.png" width="750">
</p>

<p align="left">
  <img src="images/image9.png" width="750">
</p>

After applying the change, I restarted the VM and re-ran the scan to confirm the STIG passed.

<p align="left">
  <img src="images/image10.png" width="750">
</p>

<p align="left">
  <img src="images/image11.png" width="750">
</p>

---

### 6Ô∏è‚É£ Revert the Manual Fix + Confirm Failure Returns

After confirming the fix worked, I reverted it to prove the scan would fail again.

* I set the Group Policy setting back to **Disabled**
  * `Computer Configuration ‚Üí Administrative Templates ‚Üí Windows Components ‚Üí Event Log Service ‚Üí Application ‚Üí Specify the maximum log file size (KB) ‚Üí Disabled`

<p align="left">
  <img src="images/image12.png" width="750">
</p>

Then I re-scanned and confirmed the control returned to a failed state.

<p align="left">
  <img src="images/image13.png" width="750">
</p>

<p align="left">
  <img src="images/image14.png" width="750">
</p>

---

### 7Ô∏è‚É£ Generate + Apply the PowerShell Remediation

Once I understood the manual fix, I translated it into an automated PowerShell remediation script.

My goals for the script were to:
* Create the required registry path if it doesn‚Äôt exist
* Set the `MaxSize` DWORD value to **32768** (or higher)
* Ensure the setting is applied persistently (policy-backed path)
* Align clearly to **STIG ID WIN11-AU-00500**

**Execution workflow:**
1. I logged into the VM
2. I downloaded the PowerShell script from my GitHub repo
3. I ran PowerShell **as Administrator**
4. I executed the remediation script

**Before / After:**

<p align="left">
  <img src="images/image15.png" width="750">
</p>

<p align="left">
  <img src="images/image16.png" width="750">
</p>

---

### 8Ô∏è‚É£ Re-Scan + Confirm STIG Pass

After running the script, I re-ran the Tenable compliance scan and confirmed **WIN11-AU-00500** was now passing.

<p align="left">
  <img src="images/image17.png" width="750">
</p>

<p align="left">
  <img src="images/image18.png" width="750">
</p>

<p align="left">
  <img src="images/image19.png" width="750">
</p>

---

## ‚úÖ Conclusion

In this lab, I implemented **WIN11-AU-00500** end-to-end using both a **manual hardening change** and a **PowerShell automation** approach. I validated each stage by rescanning with Tenable to confirm the control failed when reverted and passed when applied. This demonstrates a repeatable workflow for turning STIG guidance into verified, scriptable configuration enforcement in an enterprise-like environment.
