#!/bin/bash
#
# root-password-Create-Vulnerability.sh
# -------------------------------------
# Intentionally weakens Linux security by:
#   1. Enabling root SSH login (PermitRootLogin yes)
#   2. Setting the root password to "root"
#
# This script is intentionally INSECURE and should only be used
# inside isolated Cyber Range lab environments for vulnerability
# creation purposes.
#

set -e

echo -e "\n=== Creating Root Password Vulnerability ===\n"

# -------------------------------------------------------------
# 1. Enable PermitRootLogin yes
# -------------------------------------------------------------
echo "[1/2] Enabling PermitRootLogin yes in sshd_config..."

if sudo grep -q '^PermitRootLogin' /etc/ssh/sshd_config; then
    sudo sed -i 's/^PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
else
    echo "PermitRootLogin yes" | sudo tee -a /etc/ssh/sshd_config >/dev/null
fi

sudo systemctl restart sshd
echo "✓ Root SSH login enabled."

# -------------------------------------------------------------
# 2. Set root password to 'root'
# -------------------------------------------------------------
echo "[2/2] Setting root password to the insecure value 'root'..."

echo -e "root\nroot" | sudo passwd root >/dev/null 2>&1

if [[ $? -eq 0 ]]; then
    echo "✓ Root password changed to 'root' (intentionally insecure)."
else
    echo "✗ Failed to change root password."
    exit 1
fi

echo -e "\n=== Vulnerability Creation Complete ===\n"

# NOTE:
# Previously this script deleted itself via:
#     rm root-password-Create-Vulnerability.sh
# This is unsafe and has been removed intentionally.
# You may delete the script manually if desired.
